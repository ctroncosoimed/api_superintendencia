version: '2'
services:
  web:
    build: .
    environment:
      PRESTADORES_URL: https://api.superdesalud.gob.cl/prestadores/v1/prestadores/
      PRESTADORES_APIKEY: c5ddb7355c548e726d04fac8cf35a5d43468d5e4
      USE_ONLY_DATABASE: 0
      KUE_PREFIX: queue
      REDIS_ADDR: redis:6379      
    volumes:
      - .:/app
      - /app/node_modules
    ports:
      - "3000:3000"
      - "5000:5000"
    depends_on:
      - db
      - redis
  db:
    container_name: db
    image: mongo:3.2
    command: mongod --smallfiles
  redis:
    image: redis
    ports:
      - "6379:6379"
  initialize:
    build: .
    command: "npx babel-node jobs/initialize/run.js"
    depends_on:
      - redis
      - db